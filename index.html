<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Count</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      user-select: none;
      cursor: pointer;
    }
    #counter {
      font-size: 6rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div id="counter">CLICK TO START</div>

<script>
  let count = 0;
  const max = 10;
  const counter = document.getElementById("counter");
  let started = false;
  let interval;

  function beep() {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    osc.frequency.value = 850;
    osc.connect(ctx.destination);
    osc.start();
    setTimeout(() => {
      osc.stop();
      ctx.close();
    }, 120);
  }

  function forceFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(() => {});
    }
  }

  function reset() {
    clearInterval(interval);
    started = false;
    counter.textContent = "CLICK TO START";
  }

  function startCounting() {
    if (started) return;
    started = true;

    forceFullscreen();

    count = 1;
    counter.textContent = count;
    beep();

    interval = setInterval(() => {
      count++;
      counter.textContent = count;
      beep();

      if (count >= max) {
        clearInterval(interval);
        counter.textContent = "DONE";
      }
    }, 1000);
  }

  // If fullscreen exits â†’ snap back + reset
  document.addEventListener("fullscreenchange", () => {
    if (started && !document.fullscreenElement) {
      reset();
      setTimeout(forceFullscreen, 50);
    }
  });

  // If tab loses visibility (overview, switching apps)
  document.addEventListener("visibilitychange", () => {
    if (started && document.hidden) {
      reset();
      setTimeout(forceFullscreen, 50);
    }
  });

  // Block input after start
  document.addEventListener("keydown", e => {
    if (started) {
      e.preventDefault();
      reset();
      setTimeout(forceFullscreen, 50);
    }
  });

  document.addEventListener("contextmenu", e => e.preventDefault());

  document.body.addEventListener("click", startCounting);
</script>

</body>
</html>
